<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waste Management Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body {
            padding-top: 20px;
            font-family: Arial, sans-serif;
            margin: 0;
            background-image: url('/mnt/data/image.png'); /* Path to your uploaded image */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
        }
        #map {
            height: 500px;
            width: 80%;
            margin: 0 auto;
            position: relative;
            background-color: rgba(255, 255, 255, 0.8); /* To make the map stand out */
            border-radius: 15px;
        }
        .info-labels {
            text-align: center;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .info-labels span {
            display: inline-block;
            width: 120px;
            height: 30px;
            border-radius: 3px;
            color: white;
            line-height: 30px;
            text-align: center;
        }
        .full {
            background-color: red;
        }
        .not-full {
            background-color: green;
        }
        .empty-scattered {
            background-color: darkgreen;
        }
        .full-scattered {
            background-color: orange;
        }
        .leaflet-control-custom {
            background: white;
            border: 2px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            position: absolute;
            z-index: 1000;
        }
        .leaflet-control-custom button {
            border: none;
            background: none;
            font-size: 16px;
            margin: 5px;
        }
        .recenter-btn {
            bottom: 10px;
            left: 10px;
            padding: 10px 15px;
        }
        .compass-controls {
            top: 10px;
            right: 10px;
            padding: 10px 15px;
        }
    </style>
</head>
<body>
    <CENTER><h1>TRASH TRACKERS</h1></CENTER>
    <div id="map"></div>

    <div class="info-labels">
        <span class="full">Full Dustbin</span>
        <span class="not-full">Not Full Dustbin</span>
        <span class="empty-scattered">Empty Scattered</span>
        <span class="full-scattered">Full Scattered</span>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        var map = L.map('map').setView([13.0827, 80.2707], 16);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        // Define the center point and 200m radius circle
        var centerLatLng = [13.0827, 80.2707];
        var radius = 200;
        var originalCenter = L.latLng(centerLatLng);

        // Draw a circle to represent the 200-meter radius
        var circle = L.circle(centerLatLng, {
            color: '#4caf50',
            fillColor: '#4caf50',
            fillOpacity: 0.2,
            radius: radius
        }).addTo(map);

        // Function to get new coordinates for random dustbin placement
        function getNewCoordinates(center, distance, angle) {
            var angleInRadians = angle * (Math.PI / 180);
            var newLat = center[0] + (distance / 111320) * Math.cos(angleInRadians);
            var newLng = center[1] + (distance / (111320 * Math.cos(center[0] * (Math.PI / 180)))) * Math.sin(angleInRadians);
            return [newLat, newLng];
        }

        // Function to place random dustbins based on integer array
        function placeRandomDustbins(integerArray) {
            const minInterval = 30.48; // Minimum distance in meters (100 feet)
            const maxInterval = 182.88; // Maximum distance in meters (600 feet)

            for (let i = 0; i < integerArray.length; i++) {
                const randomDistance = Math.random() * (maxInterval - minInterval) + minInterval;
                const randomAngle = Math.random() * 360;
                const binLocation = getNewCoordinates(centerLatLng, randomDistance, randomAngle);

                var dustbinColor;
                switch (integerArray[i]) {
                    case 0:
                        dustbinColor = 'green'; // Not Full
                        break;
                    case 1:
                        dustbinColor = 'darkgreen'; // Empty Scattered
                        break;
                    case 2:
                        dustbinColor = 'red'; // Full
                        break;
                    case 3:
                        dustbinColor = 'orange'; // Full Scattered
                        break;
                    default:
                        dustbinColor = 'black'; // Default case
                        break;
                }

                L.marker(binLocation, {
                    icon: L.divIcon({
                        className: 'dustbin-icon',
                        html: `<div style="background-color: ${dustbinColor}; width: 10px; height: 10px; border-radius: 50%;"></div>`,
                        iconSize: [20, 20]
                    })
                }).addTo(map).bindPopup("Dustbin: " + dustbinColor);
            }
        }

        // Function to place a moving person marker
        function placeMovingPerson() {
            const personRadius = 100; 
            const randomDistance = Math.random() * personRadius;
            const randomAngle = Math.random() * 360;
            const personLocation = getNewCoordinates(centerLatLng, randomDistance, randomAngle);

            L.marker(personLocation, {
                icon: L.divIcon({
                    className: 'person-icon',
                    html: `<div style="background-color: blue; width: 15px; height: 15px; border-radius: 50%;"></div>`,
                    iconSize: [20, 20]
                })
            }).addTo(map).bindPopup("Person");
        }

        // Fetch the integer array and place markers
        fetch('results.txt')
            .then(response => response.text())
            .then(data => {
                const integerArray = data.trim().split('').map(char => {
                    const number = parseInt(char, 10);
                    return !isNaN(number) ? number : null;
                }).filter(num => num !== null);

                // Place random dustbins and person marker
                placeRandomDustbins(integerArray);
                placeMovingPerson();
            })
            .catch(error => console.error('Error fetching file:', error));

        // Add recenter button
        L.control({ position: 'bottomleft' }).onAdd = function () {
            var div = L.DomUtil.create('div', 'leaflet-control-custom recenter-btn');
            div.innerHTML = '<button onclick="map.setView(originalCenter, 16)">Recenter</button>';
            return div;
        }.addTo(map);

        // Add navigation buttons
        L.control({ position: 'topright' }).onAdd = function () {
            var div = L.DomUtil.create('div', 'leaflet-control-custom compass-controls');
            div.innerHTML = `
                <button onclick="map.panBy([0, -100])">North</button>
                <button onclick="map.panBy([100, 0])">East</button>
                <button onclick="map.panBy([-100, 0])">West</button>
                <button onclick="map.panBy([0, 100])">South</button>
            `;
            return div;
        }.addTo(map);
    </script>
</body>
</html>
